<html>
	<head>
		<title>Upload</title>
		<link rel="stylesheet" href="/css-bin/csssnehal.css">
	</head>
	<body>
		<form id="upload" action="/cgi-bin/fileupl.cgi" method="post" enctype="multipart/form-data">
			<label for="file">Select your File</label></br>
			<input type="file" id="file" name="file" class="center" required><br>
			<input type="hidden" name="sessionid" class="center" value="%s">
			<input type="hidden" name="utype" id="utype" value="new">
			<button type="submit">Upload</button>
		</form>

		<p id="outt"></p>

		<script>
			document.getElementById('upload').addEventListener('submit',function(event){
				event.preventDefault();

				var fdata = new FormData(this);
				var xhr = new XMLHttpRequest();

				xhr.open('POST','/cgi-bin/fchk.cgi',true);
				xhr.onload = function()
				{
					var resp;
					if(xhr.responseText=='0')
					{
						resp='<p>Attempt to upload this file had failed previously.Decide:</p><brk><button onclick="decision(true)">Resume</button><brk><button onclick="decision(false)">Restart</button>'
						document.getElementById('outt').innerHTML=resp;
					}
					if(xhr.responseText=='1')
					{
						resp='<p>File of different size already exists , Kindly rename this file or reload this file</p><brk><button onclick="decision(false)">Reupload</button>';
						document.getElementById('outt').innerHTML=resp;
					}
					if(xhr.responseText=='2')
					{
						resp='<p>File already exists</p>';
						document.getElementById('outt').innerHTML=resp;
					}
					if(xhr.responseText=='3')
					{
						document.getElementById('utype').value='new';
						document.getElementById('upload').submit();
					}
					if(xhr.responseText=='4')
					{
						resp='<p>File too large(>20MB)</p>';
						document.getElementById('outt').innerHTML=resp;
					}
					if(xhr.responseText>'4')
					{
						document.getElementById('outt').innterHTML=xhr.responseText;
					}
				}
				xhr.send(fdata);
			});

				function decision(uploadstatus)
				{
					if(uploadstatus)
					{
						document.getElementById('utype').value='old';
						document.getElementById('upload').submit();
					}
					else
					{
						document.getElementById('utype').value='new';
						document.getElementById('upload').submit();
					}
				}
		</script>
	</body>
</html>

